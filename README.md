# 1C-Extension-Loader

Загрузка расширений 1С (.cfe) в базу через ibcmd: веб-форма, сохранённые профили.

Веб-интерфейс и MCP-сервер для загрузки расширений (.cfe) в базу 1С через `ibcmd` без ручного открытия Конфигуратора. Расширение загружается с нужными настройками (активно, без безопасного режима и защиты от опасных действий).

---

## Возможности

- **Веб-форма** — укажите данные один раз, сохраните профиль, затем запускайте загрузку по кнопке.
- **Сохранённые профили** — выбор профиля из списка, загрузка в форму или запуск без повторного ввода данных.
- **MCP (Model Context Protocol)** — вызов загрузки из Cursor/IDE по имени профиля и расширения.
- **Один скрипт** — PowerShell-раннер (`load-extension-ibcmd.ps1`) выполняет загрузку .cfe и настройку расширения.

---

## Требования

- **Windows** (скрипт рассчитан на PowerShell).
- **Python 3.10+**.
- **1С:Предприятие** с установленным `ibcmd` (каталог `bin` с `ibcmd.exe` и `1cv8.exe`).
- Файл расширения в формате **.cfe**.

---

## Установка

1. Клонируйте репозиторий или скачайте архив.
2. Установите зависимости:

```powershell
cd <путь-к-проекту>
python -m pip install -r requirements.txt
```

3. При необходимости отредактируйте `host.config.json` (пути по умолчанию относительные и работают из корня проекта).

---

## Запуск

Из корня проекта:

```powershell
python server.py
```

Сервер будет доступен по адресу: **http://127.0.0.1:9010/** (страница только для localhost).

---

## Как пользоваться веб-интерфейсом

1. Откройте в браузере: **http://127.0.0.1:9010/** или **http://127.0.0.1:9010/ui**.

2. **Вариант А — уже есть сохранённый профиль**
   - В блоке «Сохранённые профили» выберите профиль из списка.
   - Нажмите **«Запустить»** — загрузка пойдёт по выбранному профилю.
   - Либо нажмите **«Загрузить в форму»**, при необходимости измените данные и нажмите **«Сохранить»** или **«Запустить»**.

3. **Вариант Б — новый профиль**
   - Заполните форму: имя профиля, путь к базе 1С, пользователь и пароль ИБ, пути к `ibcmd.exe` / `1cv8.exe`, папка логов, имя расширения и путь к файлу .cfe.
   - Нажмите **«Сохранить»** — профиль появится в списке сохранённых.
   - Нажмите **«Запустить»** — начнётся загрузка расширения в указанную базу.

4. Результат (успех или ошибка) отображается под кнопками; при успехе указывается путь к логу.

---

## Конфигурация

Файл **host.config.json** в корне проекта:

| Параметр | Описание |
|----------|----------|
| `host` | Адрес сервера (по умолчанию 127.0.0.1) |
| `port` | Порт (по умолчанию 9010) |
| `runner_script_path` | Путь к `load-extension-ibcmd.ps1` (относительно папки с конфигом) |
| `profiles_dir` | Папка с JSON-профилями (по умолчанию `./profiles`) |
| `default_profile` | Профиль по умолчанию для MCP-инструментов |

Профили хранятся в `profiles/*.json`. Пример структуры — в `profiles/profile-template.json`. Пароль можно не хранить в файле, а задать через переменную окружения (поле `ib_password_env` в профиле).

---

## MCP (Cursor / IDE)

Сервер реализует протокол MCP на пути `/mcp`. В Cursor можно добавить в настройки MCP (например, `.cursor/mcp.json`):

```json
{
  "1c-extension-loader": {
    "url": "http://127.0.0.1:9010/mcp",
    "timeout": 1200,
    "disabled": false
  }
}
```

При запущенном `python server.py` ассистент может вызывать инструменты:

- `list_profiles` — список профилей;
- `list_available_extensions` — список расширений по профилю;
- `validate_environment` — проверка путей и прав;
- `load_extension` — загрузка расширения по имени профиля и (при необходимости) расширения.

---

## Перенос на другой компьютер

Скопируйте папку проекта (или нужные файлы). На новом ПК:

1. Установите Python и выполните `pip install -r requirements.txt`.
2. Запустите `python server.py`.
3. Откройте http://127.0.0.1:9010/ и либо создайте новый профиль с путями этого ПК, либо отредактируйте существующий (пути к базе, .cfe и 1С должны быть актуальны для этого компьютера).

В конфиге используются относительные пути, поэтому менять их при переносе не обязательно.

---

## Безопасность

- Интерфейс рассчитан на использование только на localhost.
- Пароли хранятся в JSON-профилях в папке `profiles/`; при публикации в репозитории не коммитьте файлы с реальными паролями (используйте `profile-template.json` как образец).
- Для пароля можно использовать переменную окружения (`ib_password_env` в профиле).

---

## Лицензия

Использование на своё усмотрение. Проверяйте совместимость с вашей версией 1С и политиками безопасности.
